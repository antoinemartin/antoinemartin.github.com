<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Running Django Under Windows With Iis Using Fcgi - mrtn.me</title><meta name=Description content><meta property="og:title" content="Running Django Under Windows With Iis Using Fcgi"><meta property="og:description" content="Update: The configuration process described in this post can be achieved with only one management command if you install the django-windows-tools application.
Windows is probably not the best production environment for Django but sometimes one doesn&rsquo;t have the choice. In that case, a few options aleardy exist, most notably the one developed by helicontech that relies on Microsoft&rsquo;s Web Platform Installer. This solution, which is described here, relies on the installation of a specific native Handler developed by Helicontech."><meta property="og:type" content="article"><meta property="og:url" content="http://mrtn.me/posts/2012/06/27/running-django-under-windows-with-iis-using-fcgi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-06-27T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-02T03:16:09+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Running Django Under Windows With Iis Using Fcgi"><meta name=twitter:description content="Update: The configuration process described in this post can be achieved with only one management command if you install the django-windows-tools application.
Windows is probably not the best production environment for Django but sometimes one doesn&rsquo;t have the choice. In that case, a few options aleardy exist, most notably the one developed by helicontech that relies on Microsoft&rsquo;s Web Platform Installer. This solution, which is described here, relies on the installation of a specific native Handler developed by Helicontech."><meta name=application-name content="mrtn.me"><meta name=apple-mobile-web-app-title content="mrtn.me"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://mrtn.me/posts/2012/06/27/running-django-under-windows-with-iis-using-fcgi/><link rel=prev href=http://mrtn.me/posts/2012/03/24/using-eclipse-templates-to-ease-android-logging/><link rel=next href=http://mrtn.me/posts/2012/07/04/django-on-windows-run-celery-as-a-windows-service/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Running Django Under Windows With Iis Using Fcgi","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/mrtn.me\/posts\/2012\/06\/27\/running-django-under-windows-with-iis-using-fcgi\/"},"genre":"posts","keywords":"django, iis, windows, fcgi","wordcount":1677,"url":"http:\/\/mrtn.me\/posts\/2012\/06\/27\/running-django-under-windows-with-iis-using-fcgi\/","datePublished":"2012-06-27T00:00:00+00:00","dateModified":"2022-05-02T03:16:09+02:00","publisher":{"@type":"Organization","name":"Antoine Martin"},"author":{"@type":"Person","name":"Antoine Martin"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=mrtn.me>mrtn.me</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title="Blog posts">Posts </a><a class=menu-item href=/about/ title="About me">About </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=https://github.com/antoinemartin title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=mrtn.me>mrtn.me</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title="Blog posts">Posts</a><a class=menu-item href=/about/ title="About me">About</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=https://github.com/antoinemartin title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animated flipInX">Running Django Under Windows With Iis Using Fcgi</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://linked.in/in/antoinemartin title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Antoine Martin</a></span>&nbsp;<span class=post-category>included in <a href=/categories/devops/><i class="far fa-folder fa-fw"></i>DevOps</a>&nbsp;<a href=/categories/django/><i class="far fa-folder fa-fw"></i>Django</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=27-06>27-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1677 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div></div><div class=content id=content><p><strong>Update</strong>: The configuration process described in this post can be achieved
with only one management command if you install the
<a href=https://github.com/antoinemartin/django-windows-tools target=_blank rel="noopener noreffer">django-windows-tools application</a>.</p><p>Windows is probably not the best production environment for
<a href=https://www.djangoproject.com/ target=_blank rel="noopener noreffer">Django</a> but sometimes one doesn&rsquo;t have the
choice. In that case, a few options aleardy exist, most notably the one
developed by <a href=http://www.helicontech.com/ target=_blank rel="noopener noreffer">helicontech</a> that relies on
Microsoft&rsquo;s
<a href=http://www.microsoft.com/web/downloads/platform.aspx target=_blank rel="noopener noreffer">Web Platform Installer</a>.
This solution, which is described
<a href=http://www.microsoft.com/web/downloads/platform.aspx target=_blank rel="noopener noreffer">here</a>, relies on the
installation of a specific native Handler developed by Helicontech.</p><p>This handler manages the communication between IIS and the Django application
through the <a href=http://www.fastcgi.com target=_blank rel="noopener noreffer">FastCGI protocol</a> with the help of a little
python script that bridges FastCGI to WSGI. This script is derived from the
Allan Saddi <a href=http://trac.saddi.com/flup target=_blank rel="noopener noreffer">flup package</a> that is already used by
Django in the <code>manage.py runfcgi</code> command. The flup package doesn&rsquo;t work under
Windows and Helicontech has made the necessary adaptations to make it work with
its handler.</p><p>Since its version 7, IIS does however support FastCGI natively, so the use of a
specific handler to support Django is not needed. This post describes how to
configure and run a Django application with the native FastCGI IIS handler. For
that, I have myself adapted the Helicontech FastCGI to WSGI script to make it a
<a href=https://gist.github.com/3004168 target=_blank rel="noopener noreffer">Django management command</a>.</p><h2 id=python-installation>Python installation</h2><p>But before that, to run Django you will need to have python on your server. If
like me for some reason it is uneasy for you to run a software installer on your
server, a good choice is to use
<a href=http://www.portablepython.com/ target=_blank rel="noopener noreffer">Portable Python</a>. With it, you can install and
configure your python environment on your development or staging server and
install it in your production server(s) by just copying over the <code>python</code>
folder. You can even have different python environments with differents
configurations on the same server. To use the portable python installation in
copied in <code>d:\python</code> from a command line window, juste type:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>set path=d:\python\app\scripts;d:\python\app;%path%
</span></span></code></pre></td></tr></table></div></div><p>And then python and its commands are available from the command line:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/command.png data-srcset="/images/django/command.png, /images/django/command.png 1.5x, /images/django/command.png 2x" data-sizes=auto alt=/images/django/command.png title=img></p><p>Another advantage of Portable Python is that it comes already bundled with
<a href=http://sourceforge.net/projects/pywin32/ target=_blank rel="noopener noreffer">The Python for Windows extensions</a>
(a.k.a. pywin32) and Django.</p><h2 id=adding-fastcgi-to-the-project>Adding FastCGI to the project</h2><p>In our example, the Django project will be named <code>esplayer</code> and will be
installed in <code>d:\sites\esplayer</code>. Please note that this configuration has been
tested on Windows 2008 Server R2.</p><p>Take the <a href=https://gist.github.com/3004168 target=_blank rel="noopener noreffer">fcgi.py</a> file and copy it in the
<code>management\commands</code> directory of one of your project applications so that the
<code>manage.py help fcgi</code> command returns you:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/fcgi.png data-srcset="/images/django/fcgi.png, /images/django/fcgi.png 1.5x, /images/django/fcgi.png 2x" data-sizes=auto alt=/images/django/fcgi.png title=img></p><h2 id=configure-the-fastcgi-application-on-iis>Configure the FastCGI application on IIS</h2><p>The next step is to configure the FastCGI Application on IIS. FastCGI is
available whenever you have installed the CGI feature on your IIS installation.
Run the server manager and go to the IIS role and configuration. Select your
website. You should see a FastCGI Settings icon:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/fastcgi_settings.png data-srcset="/images/django/fastcgi_settings.png, /images/django/fastcgi_settings.png 1.5x, /images/django/fastcgi_settings.png 2x" data-sizes=auto alt=/images/django/fastcgi_settings.png title=img></p><p>Double click on it and select the <em>Add application</em> action. Enter the following
parameters:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/fcgi_configuration.png data-srcset="/images/django/fcgi_configuration.png, /images/django/fcgi_configuration.png 1.5x, /images/django/fcgi_configuration.png 2x" data-sizes=auto alt=/images/django/fcgi_configuration.png title=img></p><ul><li>In <code>Full Path</code>, enter the path to your python executable.</li><li>In <code>Arguments</code>, enter the command line for running our fcgi command, i.e.
<code>d:\sites\esplayer\esplayer\manage.py fcgi --pythonpath=d:\sites\esplayer --settings=esplayer.settings</code>.
The <code>pythonpath</code> and <code>settings</code> arguments are needed to be path independent
(more on this later).</li></ul><p>The other arguments are optional but you should review them to enter sensible
values. The <code>Monitor changes to file</code> setting is particularly interesting. It
will allow you to specify the path of a file that will trigger a restart of the
application whenever it is modified. You can enter the path to the <code>settings.py</code>
of your project. I personally prefer to specify a file that I explicitely update
via a <code>touch</code> command.</p><h2 id=create-the-website-and-configure-it-to-use-the-fastcgi-application>Create the website and configure it to use the FastCGI application</h2><p>Once we have our FastCGI application configured, we need a web site to make use
of it. For it, we create a website pointing to our Django project:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/website_configuration.png data-srcset="/images/django/website_configuration.png, /images/django/website_configuration.png 1.5x, /images/django/website_configuration.png 2x" data-sizes=auto alt=/images/django/website_configuration.png title=img></p><p>To make the website use our FastCGI application, we create the following
<code>web.config</code> file in the root of our project (here d:\sites\esplayer\esplayer):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;system.webServer&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;handlers&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;clear/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;add</span> <span class=na>name=</span><span class=s>&#34;FastCGI&#34;</span> <span class=na>path=</span><span class=s>&#34;*&#34;</span> <span class=na>verb=</span><span class=s>&#34;*&#34;</span> <span class=na>modules=</span><span class=s>&#34;FastCgiModule&#34;</span> <span class=na>scriptProcessor=</span><span class=s>&#34;D:\python\App\python.exe|d:\sites\esplayer\esplayer\manage.py fcgi --pythonpath=d:\sites\esplayer --settings=esplayer.settings&#34;</span> <span class=na>resourceType=</span><span class=s>&#34;Unspecified&#34;</span> <span class=na>requireAccess=</span><span class=s>&#34;Script&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/handlers&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/system.webServer&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>We first clear all the request handlers and then specify that every request
(<code>path="*"</code> and <code>verb="*"</code>) should be managed by the <code>FastCgiModule</code> module. The
<code>scriptProcessor</code> attribute reproduces the <code>Full Path</code> and the <code>Arguments</code> of
our FastCGI application separated by <code>|</code>. It allows the module to identify the
FastCGI application to which the requests will be routed.</p><h2 id=static-files>Static files</h2><p>With the preceding <code>web.config</code> configuration, all the requests are routed to
the Django application. However, we want the static files of our application to
be managed by IIS itself. To do that, we first configure Django to collect the
static files in the <code>static</code> subdirectory of our project. For that, we have the
following configuration in our <code>settings.py</code> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>SITE_ROOT</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>STATIC_URL</span> <span class=o>=</span> <span class=s1>&#39;/static/&#39;</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>STATIC_ROOT</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span> <span class=n>SITE_ROOT</span><span class=p>,</span> <span class=s1>&#39;static&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>SITE_STATIC_ROOT</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span> <span class=n>SITE_ROOT</span><span class=p>,</span> <span class=s1>&#39;local_static&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Additional locations of static files</span>
</span></span><span class=line><span class=cl><span class=n>STATICFILES_DIRS</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1># Don&#39;t forget to use absolute paths, not relative paths.</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>SITE_STATIC_ROOT</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>..</span>
</span></span></code></pre></td></tr></table></div></div><p>The project wide defined static files are located in the <code>local_static</code>
directory. All the static files are collected in the <code>static</code> directory by
running the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python manage.py collecstatic
</span></span></code></pre></td></tr></table></div></div><p>In the <code>local_static</code> directory we put the following <code>web.config</code> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;system.webServer&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- this configuration overrides the FastCGI handler to let IIS serve the static files --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;handlers&gt;</span>
</span></span><span class=line><span class=cl>	  <span class=nt>&lt;clear/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;add</span> <span class=na>name=</span><span class=s>&#34;StaticFile&#34;</span> <span class=na>path=</span><span class=s>&#34;*&#34;</span> <span class=na>verb=</span><span class=s>&#34;*&#34;</span> <span class=na>modules=</span><span class=s>&#34;StaticFileModule&#34;</span> <span class=na>resourceType=</span><span class=s>&#34;File&#34;</span> <span class=na>requireAccess=</span><span class=s>&#34;Read&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/handlers&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/system.webServer&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Which basically inverts the <code>web.config</code> file or the root of the project by
clearing all the handlers and serving all requests only as static files. When
collected, this file will go in the <code>static</code> directory and will instruct IIS
that all requests below the path <code>/static</code> should be served as static files.</p><h2 id=website-creation-automation>Website creation automation</h2><p>The website creation that is described in the previous sections can be automated
with the following script that must be run as an administrator:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%windir%\system32\inetsrv\appcmd.exe set config -section:system.webServer/fastCgi /+&#34;[fullPath=&#39;d:\python\app\python.exe&#39;,arguments=&#39;d:\sites\esplayer\esplayer\manage.py fcgi --pythonpath=d:\sites\esplayer --settings=esplayer.settings&#39;,maxInstances=&#39;4&#39;,idleTimeout=&#39;1800&#39;,activityTimeout=&#39;30&#39;,requestTimeout=&#39;90&#39;,instanceMaxRequests=&#39;100000&#39;,protocol=&#39;NamedPipe&#39;,flushNamedPipe=&#39;False&#39;,monitorChangesTo=&#39;d:\sites\esplayer\esplayer\web.config&#39;]&#34; /commit:apphost
</span></span><span class=line><span class=cl>%windir%\system32\inetsrv\appcmd.exe add apppool /name:esplayer
</span></span><span class=line><span class=cl>%windir%\system32\inetsrv\appcmd.exe add site /name:esplayer /bindings:http://*:80 /physicalPath:d:\sites\esplayer\esplayer
</span></span><span class=line><span class=cl>%windir%\system32\inetsrv\appcmd.exe set app &#34;esplayer/&#34; /applicationPool:esplayer
</span></span></code></pre></td></tr></table></div></div><p>The four commands run in the script do the following actions:</p><ul><li>Create the FastCGI application.</li><li>Create the site application pool.</li><li>Create the website.</li><li>Add the created website to the application pool.</li></ul><h2 id=testing-and-troubleshooting>Testing and troubleshooting</h2><p>After the configuration, the website should be available through IIS. If this is
not the case, you will probably get a <code>500</code> Error:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/django/500_error.png data-srcset="/images/django/500_error.png, /images/django/500_error.png 1.5x, /images/django/500_error.png 2x" data-sizes=auto alt=/images/django/500_error.png title=img></p><p>The first thing to do is to check that the website is available outside of IIS
by running it with the command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python manage.py runserver 0.0.0.0:8000
</span></span></code></pre></td></tr></table></div></div><p>And accessing it on <code>http://localhost:8000</code>. If the application works as a
standalone Django application, the most common cause of error is a
misconfiguration of either the FastCGI application or the root <code>web.config</code>
file. You need to be sure that the The <code>scriptProcessor</code> attribute of the
<code>web.config</code> matches <code>Full Path</code> and the <code>Arguments</code> of the FastCGI application.</p><p>To troubleshoot further, the <code>fcgi.py</code> command provides several settings to be
put in the <code>settings.py</code> file : <code>FCGI_LOG</code> (default <code>False</code>), when <code>True</code>,
instructs the command to create a log file in the path pointed by
<code>FCGI_LOG_PATH</code>. If <code>FCGI_LOG_PATH</code> is not defined, the log file will be created
in the project root directory. The file name name pattern of the log file will
be <code>fcgi_AAMMDD_HHMMSS_XXXX.log</code>, in which <code>AAMMDD</code> is the date, <code>HHMMSS</code> the
time and <code>XXXX</code> the FastCGI application process number. If <code>DEBUG</code> is set to
<code>True</code> in the settings, the log file will contain the Django debug logs. The
<code>FCGI_DEBUG</code> setting (default <code>False</code>), when set to <code>True</code>, will output in the
log file information about the FCGI protocol transfers between IIS and the
Django application.</p><h2 id=easing-the-fastcgi-configuration>Easing the FastCGI configuration</h2><p>It is somewhat painful to have to specify the <code>pythonpath</code> and <code>settings</code>
parameters both in the FastCGI configuration and in the <code>web.config</code> file. To
avoid entering them each time, I have created a <code>manage.py</code> script in the
<code>scripts</code> subdirectory of the project root that <em>auto configures</em> itself. Here
is the source of the file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span><span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>os.path</span> <span class=kn>import</span> <span class=n>abspath</span><span class=p>,</span> <span class=n>dirname</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># the base path is my parent directory</span>
</span></span><span class=line><span class=cl><span class=n>base_path</span> <span class=o>=</span> <span class=n>dirname</span><span class=p>(</span><span class=n>dirname</span><span class=p>(</span><span class=n>abspath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.core.handlers.modpython</span> <span class=kn>import</span> <span class=n>handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Add the parent directory to the path to be able to import settings</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>base_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dirname</span><span class=p>(</span><span class=n>base_path</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Now we can import our settings and setup the environment</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>settings</span> <span class=c1># Assumed to be in the same directory.</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;Error: Can&#39;t find the file &#39;settings.py&#39; in the directory containing </span><span class=si>%r</span><span class=s2>. It appears you&#39;ve customized things.</span><span class=se>\n</span><span class=s2>You&#39;ll have to run django-admin.py, passing it your settings module.</span><span class=se>\n</span><span class=s2>(If the file settings.py does indeed exist, it&#39;s causing an ImportError somehow.)</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=vm>__file__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.core.management</span> <span class=kn>import</span> <span class=n>setup_environ</span>
</span></span><span class=line><span class=cl><span class=n>setup_environ</span><span class=p>(</span><span class=n>settings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.core.management</span> <span class=kn>import</span> <span class=n>execute_manager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>execute_manager</span><span class=p>(</span><span class=n>settings</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>With this script, the <code>Arguments</code> setting of the FastCGI application becomes
<code>d:\sites\esplayer\esplayer\scripts\manage.py fcgi</code> and the <code>scriptProcessor</code>
attribute in the <code>web.config</code> file becomes</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>scriptProcessor=&#34;D:\python\App\python.exe|d:\sites\esplayer\esplayer\script\manage.py fcgi&#34;
</span></span></code></pre></td></tr></table></div></div><h2 id=what-next>What next</h2><p>Once this configuration is done on a project and a server, replicating it across
multiple servers is easy as the only configuration not part of the project is
the one of the FastCGI application. Most configuration files are ported from
server to server with the source code of the project.</p><p>However, the first creation and configuration could benefit from having some
management commands dedicated to it. These would be part, along with the
<a href=https://gist.github.com/3004168 target=_blank rel="noopener noreffer">fcgi.py</a> command, of a specific Django
application that could be added to any project.</p><p>Furthermore, some of you may have noted that having the website point to the
root of the Django project is not mandatory. Thus the Django project itself
could be part of the python installation itself and deployed by running a Django
management command.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 02-05&nbsp;<a class=git-hash href=https://github.com/antoinemartin/antoinemartin.github.io/commit/ee938f5fe47500e91e621af4eace6a32ea6280f5 target=_blank title="commit by Antoine Martin(antoine@mindee.co) ee938f5fe47500e91e621af4eace6a32ea6280f5: 🚧 ♻️ Migrate to hugo">
<i class="fas fa-hashtag fa-fw"></i>ee938f5</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/django/>django</a>,&nbsp;<a href=/tags/iis/>iis</a>,&nbsp;<a href=/tags/windows/>windows</a>,&nbsp;<a href=/tags/fcgi/>fcgi</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2012/03/24/using-eclipse-templates-to-ease-android-logging/ class=prev rel=prev title="Using Eclipse Templates to Ease Android Logging"><i class="fas fa-angle-left fa-fw"></i>Using Eclipse Templates to Ease Android Logging</a>
<a href=/posts/2012/07/04/django-on-windows-run-celery-as-a-windows-service/ class=next rel=next title="Django on Windows: Run Celery as a Windows Service">Django on Windows: Run Celery as a Windows Service<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.98.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2012 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://linked.in/in/antoinemartin target=_blank>Antoine Martin</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:30},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-29953512-1")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-29953512-1" async></script></body></html>